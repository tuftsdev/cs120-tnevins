let map;const iconBase="https://maps.google.com/mapfiles/kml/shapes/";let gdata;function computeDistance(e,t){let n=[];for(let o of t){let t=new google.maps.LatLng(o.lat,o.lng),a=google.maps.geometry.spherical.computeDistanceBetween(e,t);!isNaN(a)&&a>0&&(o.distance=a,n.push(a))}return n}function findClosestRide(e,t){let n=computeDistance(e,t),o=Math.min(...n);for(let e of t)if(e.distance===o)return e}function addline(e,t,n){let o=findClosestRide(new google.maps.LatLng(e,t),n);const a=[{lat:o.lat,lng:o.lng},{lat:e,lng:t}];new google.maps.Polyline({path:a,geodesic:!0,map:map,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});let i=621e-6*o.distance;return'<div id="content"><div id="siteNotice"></div><h1 id="firstHeading" class="firstHeading">closet ride:'+o.username+'</h1><div id="bodyContent"><p>lat:'+o.lat+" Long:"+o.lng+"<br/>Distance from ride:"+i+" miles</br>formula: miles = meters * 0.000621</p></div></div>"}function addRides(e,t,n){map=new google.maps.Map(document.getElementById("map"),{center:{lat:e,lng:t},zoom:4});let o=new google.maps.Marker({position:new google.maps.LatLng(e,t),map:map,title:"Hello there!"});o.addListener("click",(()=>{let a=addline(e,t,n);new google.maps.InfoWindow({content:a,ariaLabel:"miles to location"}).open({anchor:o,map:map})}));for(let e of n){new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lng),icon:"./car.png",map:map,title:e.username})}}function getRides(e,t,n){let o=`username=s0ny&lat=${t}&lng=${n}`,a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status&&addRides(t,n,JSON.parse(a.response))},a.send(o)}function getLatLong(e){getRides("https://calm-inlet-90299.herokuapp.com/rides",e.coords.latitude,e.coords.longitude)}function initMap(){navigator.geolocation.getCurrentPosition(getLatLong)}window.initMap=initMap;